<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Quant Master Pro - Full Restore</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>

    <style>
        :root {
            --bg-color: #020617; --card-bg: #1e293b; --text-main: #f1f5f9; 
            --border-color: #334155; --accent: #0ea5e9; --up-color: #10b981; --down-color: #ef4444;
        }
        body { background-color: var(--bg-color); color: var(--text-main); margin: 0; padding: 0; font-family: 'Outfit', sans-serif; overflow-x: hidden; }
        
        header { position: fixed; top: 0; width: 100%; height: 65px; background: rgba(15, 23, 42, 0.98); border-bottom: 1px solid var(--border-color); z-index: 1000; display: flex; align-items: center; padding: 0 15px; box-sizing: border-box; }
        .search-area { flex: 1; display: flex; justify-content: center; }
        .search-box { position: relative; width: 100%; max-width: 300px; }
        .search-box input { width: 100%; height: 36px; border-radius: 8px; border: 1px solid var(--border-color); background: #0a0f1d; color: #fff; padding: 0 35px 0 12px; outline: none; }

        main { padding: 80px 15px 120px; display: flex; flex-direction: column; gap: 20px; max-width: 1200px; margin: 0 auto; }

        /* 1. 차트 폼 */
        .form-chart { background: #131722; border-radius: 16px; border: 1px solid var(--border-color); height: 480px !important; min-height: 480px; width: 100%; overflow: hidden; flex-shrink: 0; }
        #tv_widget { width: 100%; height: 100%; }

        /* 2. 자산 현황 폼 */
        .form-assets { background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border-color); padding: 25px; text-align: center; }
        .current-val { font-size: 2.8rem; font-weight: 900; margin: 5px 0; color: #fff; }
        .pnl-box { display: flex; justify-content: center; gap: 10px; font-size: 1.3rem; font-weight: 800; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }

        /* 3. [복구] AI 분석 로그 폼 (자동매매 위에 배치) */
        .form-ai-log { background: #020617; border-radius: 12px; border: 1px solid var(--border-color); padding: 15px; height: 120px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 0.85rem; color: #94a3b8; line-height: 1.5; }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 3px; }
        .log-time { color: var(--accent); margin-right: 8px; font-weight: 700; }

        /* 4. 자동매매 컨트롤 폼 */
        .form-controls { background: var(--card-bg); border-radius: 16px; border: 2.5px solid var(--accent); padding: 20px; text-align: center; }
        .btn-engine { width: 100%; height: 60px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-size: 1.1rem; }
        .btn-on { background: var(--accent); color: #000; }
        .btn-off { background: var(--down-color); color: #fff; }

        /* 5. 거래 리스트 폼 */
        .form-list { background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border-color); padding: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; min-width: 400px; text-align: center; }
        th { color: #94a3b8; padding: 12px 8px; border-bottom: 2px solid var(--border-color); }
        td { padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* 하단 메뉴 */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 75px; background: rgba(15, 23, 42, 0.98); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; z-index: 10001; }
        .nav-item { color: #94a3b8; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 4px; flex: 1; }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 1.3rem; }

        .up { color: var(--up-color); }
        .down { color: var(--down-color); }
    </style>
</head>
<body>

<header>
    <div onclick="history.back()" style="cursor:pointer; padding:10px;"><i class="fas fa-arrow-left"></i></div>
    <div class="search-area"><div class="search-box">
        <input type="text" id="coinIn" placeholder="코인 종목 검색..." onkeypress="if(event.key==='Enter') search()">
        <i class="fas fa-search" style="position:absolute; right:10px; top:10px; color:var(--accent);" onclick="search()"></i>
    </div></div>
    <div id="badge" style="background:var(--accent); color:#fff; padding:4px 12px; border-radius:8px; font-weight:800; font-size:0.8rem;">BTC</div>
</header>

<main>
    <div class="form-chart"><div id="tv_widget"></div></div>

    <div class="form-assets">
        <div style="font-size:0.85rem; color:#94a3b8; font-weight:600;">SEED INVESTMENT: 100,000,000 KRW</div>
        <div style="font-size:1.1rem; font-weight:700; color:#fff; margin-top:10px;">현재 총 자산</div>
        <div id="totalDisplay" class="current-val">100,000,000</div>
        <div class="pnl-box">
            <span id="pnlLabel">수입 / 손해 :</span>
            <span id="pnlValue">없음 0원</span>
        </div>
        <div id="winStat" style="margin-top:10px; font-size:0.9rem; color:var(--accent); font-weight:800;">AI 승률: 0.0% (0승 0패)</div>
    </div>

    <div class="form-ai-log" id="aiLogBox">
        <div class="log-entry"><span class="log-time">[SYSTEM]</span> 2026 WHALE TRACKING ENGINE READY...</div>
    </div>

    <div class="form-controls">
        <button id="aiBtn" onclick="toggleAI()" class="btn-engine btn-on">AI 자동매매 엔진 가동 시작</button>
        <button onclick="forceReset()" style="margin-top:15px; background:none; border:none; color:#475569; text-decoration:underline; cursor:pointer; font-size:0.75rem;">기존 데이터 전체 초기화</button>
    </div>

    <div class="form-list">
        <div style="font-weight:800; color:var(--accent); margin-bottom:15px;"><i class="fas fa-list-ul"></i> RECENT TRADE HISTORY</div>
        <table>
            <thead><tr><th>시간</th><th>구분</th><th>단가</th><th>수익률</th></tr></thead>
            <tbody id="tradeHistoryBody"></tbody>
        </table>
    </div>
</main>

<nav class="bottom-nav">
    <a href="https://minetia.github.io/Home/" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
    <a href="https://minetia.github.io/business/" class="nav-item"><i class="fas fa-briefcase"></i><span>Biz</span></a>
    <a href="https://minetia.github.io/tech/" class="nav-item"><i class="fas fa-microchip"></i><span>Tech</span></a>
    <a href="https://minetia.github.io/news/" class="nav-item"><i class="fas fa-newspaper"></i><span>News</span></a>
    <a href="#" class="nav-item active"><i class="fas fa-chart-line"></i><span>Trade</span></a>
</nav>

<script>
    const SEED = 100000000;
    const params = new URLSearchParams(window.location.search);
    let coin = params.get('coin') || 'BTC';
    document.getElementById('badge').innerText = coin;

    let wallet = JSON.parse(localStorage.getItem('myWallet')) || { mainKrw: SEED, assets: {} };
    let stats = JSON.parse(localStorage.getItem('tradeStats')) || { win: 0, loss: 0 };
    let tradeHistory = JSON.parse(localStorage.getItem('tradeHistory')) || [];
    let aiActive = JSON.parse(localStorage.getItem('aiActive')) || false;
    let price = 0;

    function addLog(msg) {
        const box = document.getElementById('aiLogBox');
        const now = new Date().toLocaleTimeString();
        box.innerHTML += `<div class="log-entry"><span class="log-time">[${now}]</span> ${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function search() {
        const v = document.getElementById('coinIn').value.toUpperCase().trim();
        if(v) location.href = `modal.html?coin=${v}`;
    }

    function forceReset() {
        if(confirm("모든 데이터를 리셋할까요?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function updateUI() {
        const coinAssets = (wallet.assets[coin] || 0) * price;
        const total = Math.floor(wallet.mainKrw + coinAssets);
        const diff = total - SEED;

        document.getElementById('totalDisplay').innerText = total.toLocaleString();
        const pLabel = document.getElementById('pnlLabel');
        const pValue = document.getElementById('pnlValue');

        if(diff > 0) { pLabel.innerText="수입 :"; pValue.innerText="+"+diff.toLocaleString()+"원"; pValue.className="up"; }
        else if(diff < 0) { pLabel.innerText="손해 :"; pValue.innerText=diff.toLocaleString()+"원"; pValue.className="down"; }
        else { pLabel.innerText="수입 / 손해 :"; pValue.innerText="없음 0원"; pValue.className=""; }

        const totalT = stats.win + stats.loss;
        const rate = totalT === 0 ? "0.0" : ((stats.win / totalT) * 100).toFixed(1);
        document.getElementById('winStat').innerText = `AI 승률: ${rate}% (${stats.win}승 ${stats.loss}패)`;

        const listBody = document.getElementById('tradeHistoryBody');
        listBody.innerHTML = tradeHistory.length > 0 ? tradeHistory.slice(0, 10).map(item => `
            <tr><td>${item.time}</td><td style="color:${item.type==='매수'?'#0ea5e9':'#ef4444'}">${item.type}</td><td>${item.price.toLocaleString()}</td><td class="${item.profit>=0?'up':'down'}">${item.profit}%</td></tr>
        `).join('') : '<tr><td colspan="4" style="color:#475569; padding:20px;">내역 없음</td></tr>';
    }

    async function getPrice() {
        try {
            const r = await axios.get(`https://api.upbit.com/v1/ticker?markets=KRW-${coin}`);
            price = r.data[0].trade_price;
            updateUI();
        } catch(e) {}
    }

    function toggleAI() {
        aiActive = !aiActive;
        localStorage.setItem('aiActive', JSON.stringify(aiActive));
        location.reload();
    }

    window.onload = function() {
        new TradingView.widget({
            "container_id": "tv_widget",
            "width": "100%", "height": "100%",
            "symbol": "UPBIT:" + coin + "KRW",
            "interval": "1", "theme": "dark", "locale": "ko", "autosize": true
        });
        if(aiActive) { 
            const btn = document.getElementById('aiBtn');
            btn.innerText="AI 엔진 가동 중지"; btn.className="btn-engine btn-off";
            addLog(`ENGINE START: Tracking KRW-${coin} Whales...`);
        }
        getPrice(); setInterval(getPrice, 2000);
    };
</script>
</body>
</html>
